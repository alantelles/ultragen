include 'templates/base.ultra.html'

class Handlers

function index(params) : Handlers
    include 'templates/upload.ultra.html'
    content = UploadForm()
    live Base(content)
end

function saveUploadedFile(params) : Handlers
    function getPathOut(folder, name)
        out = '.\\uploaded\\' + folder + '\\' + str(name)
        return out
    end
    include @Core.FileSystem
    live 'Receiving file'
    live '<br>'
    live $request[:files]
    live '<br>'
    # fIn = $request[:files][:otherfield][:serverName]
    # fOut = getPathOut($request[:files][:otherfield][:fileName])
    for ($request[:files].keys(), fileField)
        FileSystem.mkdir('uploaded\\' + fileField)
        fileEntry = $request[:files][fileField]
        if (typeof(fileEntry) == 'TListInstance')
            for (fileEntry, file)
                fIn = file[:serverName]                
                fOut = getPathOut(fileField, file[:fileName])
                print(concat('in: ', fIn, ', out: ', fOut))
                FileSystem.copy(fIn, fOut)
            end
        else
            fIn = fileEntry[:serverName]            
            fOut = getPathOut(fileField, fileEntry[:fileName])
            FileSystem.copy(fIn, fOut)
        end
    end
    # FileSystem.copy(fIn, fOut)
    index = $router.urlFor(:index)
    live '<a href="' + index + '">Index</a>'
end