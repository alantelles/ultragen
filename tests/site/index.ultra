include @Core.Web.Router
include @Core.Web.AppResponse
include @Core.Web.Cookies
include 'base.ultra.html'
$router = new Router()
$router.get('/', :index, function(params)
    AppResponse.setHeaders({'spyro': 'gyro', 'spairo': 'jaira'})
    cookieList = "<ul>"
    for(cookiesOpts.keys(), key)
        link = $router.urlFor(:set_cookie, {'key': key, 'value': cookiesOpts[key]})
        cookieList += '<li><a href="' + link + '">' + key + '=' + (cookiesOpts[key]) + '</a></li>'
    end
    cookieList += "</ul>"
    cookieList += "<p>Unset</p><ul>"
    for($request[:cookies].keys(), key)
        link = $router.urlFor(:unset_cookie, {'key': key})
        cookieList += '<li><a href="' + link + '">' + key + '</a></li>'
    end
    cookieList += "</ul>"
    content = "<p>options</p>" + cookieList + "<br>Showing cookies<br><div><pre>" + str($request[:cookies]) + "</pre></div>"
    live Base(content)
end)
$router.get('/unset_cookie/:key', :unset_cookie, function(params)
    
    # Cookies.unset(params[:key])
    Cookies.set(params[:key], '', {'max-age': 0})
    AppResponse.redirect($router.urlFor(:index))
end)
$router.get('/set_cookie/:key/:value', :set_cookie, function(params)
    
    Cookies.set(params[:key], params[:value], {'max-age': 50000, 'secure': true, 'httpOnly': false})
    AppResponse.redirect($router.urlFor(:index))
end)

cookiesOpts = {
    :zika: "Baholeros",
    :fuck_tah_shit: "main rap stream",
    :tapoha: "zika master"
}

$router.getMatch().localize()
live handler(params)